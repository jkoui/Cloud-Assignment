<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salary Spread Analysis</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        #topSalariesChart, #salaryChangesChart { height: 400px !important; }
        #comparisonChart { height: 350px !important; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">Salary Spread Analysis</h1>

        <!-- Navbar with tabs -->
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link {% if active_tab == 'tab1' %}active{% endif %}" href="{{ url_for('function1') }}">Tab 1: Overview</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if active_tab == 'tab2' %}active{% endif %}" href="{{ url_for('function2') }}">Tab 2: Function 2</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if active_tab == 'tab3' %}active{% endif %}" href="{{ url_for('function3') }}">Tab 3: Function 3</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if active_tab == 'tab4' %}active{% endif %}" href="{{ url_for('function4') }}">Tab 4: Function 4</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {% if active_tab == 'tab5' %}active{% endif %}" href="{{ url_for('function5') }}">Tab 5: Function 5</a>
            </li>
        </ul>

        <!-- Tab content -->
        <div class="tab-content mt-3">
            <div class="tab-pane {% if active_tab == 'tab1' %}active{% endif %}" id="tab1">
                <h3>Function 1 Content</h3>
            </div>

            <div class="tab-pane {% if active_tab == 'tab2' %}active{% endif %}" id="tab2">
                <h3>Function 2 Content</h3>
                {% if active_tab == 'tab2' %}
                <table class="table table-striped table-bordered">
                    <thead class="thead-dark">
                        <tr>
                            <th>Degree</th>
                            <th>University</th>
                            <th>Year</th>
                            <th>IQR</th>
                            <th>IQR Ratio</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in data %}
                        <tr>
                            <td>{{ row.degree }}</td>
                            <td>{{ row.university }}</td>
                            <td>{{ row.year }}</td>
                            <td>{{ row.IQR }}</td>
                            <td>{{ row.IQR_ratio }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% endif %}
            </div>

            <div class="tab-pane {% if active_tab == 'tab3' %}active{% endif %}" id="tab3">
                <h3>Function 3 Content</h3>
                <!-- Add your Function 3 content here -->
            </div>

            <div class="tab-pane {% if active_tab == 'tab4' %}active{% endif %}" id="tab4">
                <h3>Function 4 Content</h3>
                <!-- Add your Function 4 content here -->
            </div>

            <div class="tab-pane {% if active_tab == 'tab5' %}active{% endif %}" id="tab5">
                <h3>Salary Projection for 2024</h3>
                <p class="text-muted">Linear trend extrapolation using last N years (N=2-5 depending on data availability)</p>
                {% if active_tab == 'tab5' %}
                
                <!-- Charts Section -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Top 10 Projected Salaries for 2024</h5>
                                <canvas id="topSalariesChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Top 10 Salary Changes (%)</h5>
                                <canvas id="salaryChangesChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Top 10 Actual vs Projected Comparison</h5>
                                <canvas id="comparisonChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Data Table -->
                <h5 class="mt-4">Detailed Projection Data</h5>
                <table class="table table-striped table-bordered table-sm">
                    <thead class="thead-dark">
                        <tr>
                            <th>Degree</th>
                            <th>University</th>
                            <th>Method</th>
                            <th>Last Actual Year</th>
                            <th>Last Actual Median ($)</th>
                            <th>Predicted 2024 Median ($)</th>
                            <th>Change ($)</th>
                            <th>Change (%)</th>
                            <th>Trend Slope</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in data %}
                        <tr>
                            <td>{{ row.degree }}</td>
                            <td>{{ row.university }}</td>
                            <td><small>{{ row.method }}</small></td>
                            <td>{{ row.last_year }}</td>
                            <td class="text-right">{{ "%.2f"|format(row.last_actual_median) }}</td>
                            <td class="text-right"><strong>{{ "%.2f"|format(row.predicted_median_2024) }}</strong></td>
                            <td class="text-right {% if row.change_amount > 0 %}text-success{% else %}text-danger{% endif %}">
                                {{ "%.2f"|format(row.change_amount) }}
                            </td>
                            <td class="text-right {% if row.change_percentage > 0 %}text-success{% else %}text-danger{% endif %}">
                                {{ "%.2f"|format(row.change_percentage) }}%
                            </td>
                            <td class="text-right">{{ "%.2f"|format(row.trend_slope) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <script>
                    // Prepare data for charts
                    const projectionData = {{ data|tojson }};
                    const top10 = projectionData.slice(0, 10);
                    
                    // Top 10 Projected Salaries Chart
                    const topSalariesCtx = document.getElementById('topSalariesChart').getContext('2d');
                    new Chart(topSalariesCtx, {
                        type: 'bar',
                        data: {
                            labels: top10.map(d => d.degree.substring(0, 30) + '...'),
                            datasets: [{
                                label: 'Projected 2024 Median Salary ($)',
                                data: top10.map(d => d.predicted_median_2024),
                                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            indexAxis: 'y',
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                x: { 
                                    beginAtZero: true,
                                    title: { display: true, text: 'Salary ($)' }
                                }
                            }
                        }
                    });
                    
                    // Top 10 Salary Changes Chart
                    const changesCtx = document.getElementById('salaryChangesChart').getContext('2d');
                    const sortedByChange = [...projectionData].sort((a, b) => b.change_percentage - a.change_percentage).slice(0, 10);
                    new Chart(changesCtx, {
                        type: 'bar',
                        data: {
                            labels: sortedByChange.map(d => d.degree.substring(0, 30) + '...'),
                            datasets: [{
                                label: 'Percentage Change (%)',
                                data: sortedByChange.map(d => d.change_percentage),
                                backgroundColor: sortedByChange.map(d => d.change_percentage > 0 ? 'rgba(75, 192, 192, 0.6)' : 'rgba(255, 99, 132, 0.6)'),
                                borderColor: sortedByChange.map(d => d.change_percentage > 0 ? 'rgba(75, 192, 192, 1)' : 'rgba(255, 99, 132, 1)'),
                                borderWidth: 1
                            }]
                        },
                        options: {
                            indexAxis: 'y',
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                x: { 
                                    title: { display: true, text: 'Change (%)' }
                                }
                            }
                        }
                    });
                    
                    // Comparison Chart (Actual vs Projected)
                    const comparisonCtx = document.getElementById('comparisonChart').getContext('2d');
                    new Chart(comparisonCtx, {
                        type: 'bar',
                        data: {
                            labels: top10.map(d => d.degree.substring(0, 30) + '...'),
                            datasets: [
                                {
                                    label: 'Last Actual Median',
                                    data: top10.map(d => d.last_actual_median),
                                    backgroundColor: 'rgba(255, 159, 64, 0.6)',
                                    borderColor: 'rgba(255, 159, 64, 1)',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Projected 2024 Median',
                                    data: top10.map(d => d.predicted_median_2024),
                                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                    borderColor: 'rgba(54, 162, 235, 1)',
                                    borderWidth: 1
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: true, position: 'top' }
                            },
                            scales: {
                                y: { 
                                    beginAtZero: true,
                                    title: { display: true, text: 'Salary ($)' }
                                }
                            }
                        }
                    });
                </script>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Optional: Add JavaScript for Bootstrap functionality -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
